import random
import math

_ = False

class MapGenerator:

    def __init__(self, game):

        self.game = game

        self.default_map = [[[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]],

                            [[[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]],
                             [[_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _], [_, _, _, _, _]]]]

        self.map = self.default_map

        self.map_detailed = [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                             [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]

        self.position = [random.randint(2, 4), 2]
        self.previous_position = None

        self.direction_list = [0, 90, 180, 270]

        self.opening_from = 0
        self.previous_opening_from = None

        self.exit_direction = 180

        self.intersection_positions = []

        self.build_path = True
        self.player_spawn_placed = False

        self.floor_weapon_placed = False
        self.floor_weapon_spawn_chance = 0.050

        self.visitable_tiles_generated = 0

    def get_layouts(self):

        # Layouts for different level pieces

        if self.opening_from == 90:

            layouts = {

                "Cross": [[1, _, _, _,  1],
                          [1, _, _, _, 1],
                          ["O", _, _, _, "O"],
                          [1, _, _, _, 1],
                          [1, _, _, _, 1]],

                "End": [[_, 1, _, 1, _],
                        [1, 1, _, 1, 1],
                        [_, _, 5, _, _],
                        [1, 1, _, 1, 1],
                        [_, 1, _, 1, _]],

                270: [[1, _, _, _, 1],
                      [2, _, _, _, 2],
                      [2, _, _, _, 2],
                      [2, _, _, _, 2],
                      [1, _, _, _, 1]],

                180: [[1, _, _, _, 1],
                      [_, _, _, _, 3],
                      [_, _, _, _, 4],
                      [_, _, _, _, 3],
                      [1, 2, 4, 2, 1]],

                0: [[1, _, _, _,  5],
                    [1, _, _, _, _],
                    [5, _, _, _, _],
                    [1, _, _, _, _],
                    [1, 1, 5, 1, 1]],
            }

        elif self.opening_from == 270:

            layouts = {

                "Cross": [[1, _, _, _,  1],
                          [_, _, _, _, _],
                          [_, _, _, _, _],
                          [_, _, _, _, _],
                          [1, _, _, _, 1]],

                "End": [[_, 5, _, 5, _],
                        [5, 5, _, 5, 5],
                        [_, _, 3, _, _],
                        [5, 5, _, 5, 5],
                        [_, 5, _, 5, _]],

                90: [[1, 1, "O", 1, 1],
                     [4, _, _, _, 4],
                     [4, _, _, _, 4],
                     [4, _, _, _, 4],
                     [1, 1, "O", 1, 1]],

                0: [[1, 2, 3, 2, 2],
                    [3, _, _, _, 4],
                    [2, _, _, _, _],
                    [3, _, _, _, 4],
                    [3, 4, _, 4, 2]],

                180: [[1, 1, 1, 1, 1],
                      [1, _, _, _, 1],
                      [_, _, _, _, 1],
                      [_, _, _, _, 1],
                      [1, 1, _, _, 1]],
            }

        elif self.opening_from == 180:

            layouts = {

                "Cross": [[1, _, _, _,  1],
                          [1, _, _, _, 1],
                          [_, _, _, _, _],
                          [1, _, _, _, 1],
                          [1, _, _,  _, 1]],

                "End": [[_, 3, _, 3, _],
                        [3, 2, _, 2, 3],
                        [_, _, 4, _, _],
                        [3, 2, _, 2, 3],
                        [_, 3, _, 3, _]],

                0: [[1, 1, 5, 1, 1],
                    [1, _, _, _, 1],
                    ["O", _, _, _, _],
                    [1, _, _, _, 1],
                    [1, 1, 5, 1, 1]],

                90: [[1, 1, "O", 1, 1],
                     [1, _, _, _, 2],
                     ["O", _, _, _, 3],
                     [1, _, _, _, 2],
                     [1, 3, 2, 3, 1]],

                270: [[2, 4, 2, 4, 1],
                      [_, _, _, _, 4],
                      [_, _, _, _, 3],
                      [_, _, _, _, 4],
                      [1, _, _, _, 1]],

            }

        elif self.opening_from == 0:

            layouts = {

                "Cross": [[1, 1, _, 1,  1],
                          [_, _, _, _, 1],
                          [_, _, _, _, _],
                          [_, _, _, _, 1],
                          [1, _, _,  _, 1]],

                "End": [[_, 5, _, 5, _],
                        [5, 5, _, 5, 5],
                        [_, _, 5, _, _],
                        [5, 5, _, 5, 5],
                        [_, 5, _, 5, _]],

                180: [[1, 4, 4, 4, 1],
                      [1, _, _, _, 1],
                      ["O", _, _, _, "O"],
                      [1, _, _, _, 1],
                      [1, 4, 4, 4, 1]],

                270: [[2, 2, 2, 2, 2],
                      [2, _, _, _, _],
                      [2, _, _, _, _],
                      [2, _, _, _, _],
                      [2, _, _, _, 2]],

                90: [[1, _, _, _, 1],
                     [3, _, _, _, _],
                     [3, _, _, _, _],
                     [3, _, _, _, _],
                     [1, 3, 3, 3, 1]],

            }

        return layouts

    def find_piece(self):

        layouts = self.get_layouts()
        self.previous_position = self.position.copy()

        self.get_position_and_direction()

        if (8 >= self.position[1] >= 0) and (5 >= self.position[0] >= 0) and self.map[self.position[1]][self.position[0]] == [[_, _, _, _, _]] * 5:

            if random.randint(0, 10) >= 3:

                self.intersection_positions.append(self.position.copy())
                self.visitable_tiles_generated += 1

                return layouts["Cross"]

            else:

                self.visitable_tiles_generated += 1

                return layouts[self.exit_direction]

        else:

            return self.make_dead_end()

    def get_position_and_direction(self):
        self.previous_opening_from = self.opening_from

        # Getting position for turns
        if (self.opening_from == ((self.exit_direction + 90) % 360)) or (self.opening_from == ((self.exit_direction - 90) % 360)):

            direction = math.radians(self.opening_from + 180)

            self.position[0] += int(math.cos(direction))
            self.position[1] -= int(math.sin(direction))

        # Getting position for straight tiles
        else:

            direction = math.radians(self.exit_direction)

            self.position[0] += int(math.cos(direction))
            self.position[1] -= int(math.sin(direction))

        # Opening from opposite direction of exit
        self.opening_from = (self.exit_direction + 180) % 360

    def make_dead_end(self):

        layouts = self.get_layouts()

        self.position = self.previous_position.copy()
        self.build_path = False

        if self.position in self.intersection_positions:
            return layouts["Cross"]

        return layouts["End"]

    def generate_path(self):

        while self.build_path:

            self.exit_direction = random.choice(self.direction_list)

            while (self.exit_direction == self.opening_from) or (self.exit_direction == self.previous_opening_from):

                self.exit_direction = random.choice(self.direction_list)

            cell = self.find_piece()
            if cell:
                self.map[self.position[1]][self.position[0]] = cell

    def add_structure_and_items(self):

        last_visitable_cell = None

        for i, row, in enumerate(self.map):
            for j, cell in enumerate(row):

                if cell[2][2] == _ and cell != [[_, _, _, _, _]] * 5:

                    if not self.player_spawn_placed:

                        self.map[i][j][2][2] = "X"
                        self.player_spawn_placed = True

                    else:

                        if not self.floor_weapon_placed:

                            if random.random() < self.floor_weapon_spawn_chance:

                                self.map[i][j][2][2] = random.choice(list(self.game.object_handler.weapons_keys))
                                self.floor_weapon_placed = True

                                continue

                        spawn_number = random.randint(1, 10)

                        if spawn_number <= 3:
                            self.map[i][j][2][2] = random.choice(list(self.game.object_handler.pickups_keys)[:-1])
                        if spawn_number == 4:
                            self.map[i][j][2][2] = random.choice(list(self.game.object_handler.non_pickups_keys))
                        if spawn_number == 5:
                            # Make this not suck later
                            self.map[i][j][2][2] = random.choice(["K", "L", "M", "N"])
                        if 8 >= spawn_number >= 6:
                            self.map[i][j][2][2] = random.choice(list(self.game.object_handler.enemies_keys)[:3])

                    last_visitable_cell = self.map[i][j]

                elif cell == [[_, _, _, _, _]] * 5:

                    self.map[i][j] = [[_, 1, 1, 1, _], [1, _, _, _, 1], [1, _, _, _, 1], [1, _, _, _, 1], [_, 1, 1, 1, _]]

        # Makes Exit
        last_visitable_cell[2][2] = "F"

    def generate(self):

        self.map[self.position[1]][self.position[0]] = self.find_piece()
        self.previous_opening_from = self.opening_from

        self.generate_path()

        # Generates more paths until paths have been made from all intersections
        while self.intersection_positions:

            for position in self.intersection_positions:

                for direction in self.direction_list:

                    self.build_path = True

                    self.position = position.copy()
                    self.opening_from = direction

                    self.generate_path()

                if position in self.intersection_positions:
                    self.intersection_positions.remove(position)

            self.build_path = True

        self.add_structure_and_items()

    def add_border(self):

        for row in self.map_detailed:

            row.insert(0, 1)
            row.insert(len(row), 1)

        self.map_detailed.insert(0, [1] * 32)
        self.map_detailed.insert(len(self.map_detailed), [1] * 32)

    def translate(self):

        # Translate the cells into a single continuous map
        for i, row in enumerate(self.map):  # Row
            for j, cell in enumerate(row):  # Cell [[0, 0,0], [0, 0, 0], [0, 0, 0]]
                for k, level in enumerate(cell):  # Level [0, 0, 0]
                    for h, item in enumerate(level):  # Item 0

                        self.map_detailed[(i * 5) + k][h + (j * 5)] = item

        #  Add Border
        self.add_border()

    def reset(self):
        self.__init__(self.game)

    def make_map(self):

        while self.visitable_tiles_generated < 42:

            self.reset()
            self.generate()

        self.translate()
        # self.translate_to_strings()

    def translate_to_strings(self):
        for i, row in enumerate(self.map_detailed):
            for j, item in enumerate(row):
                self.map_detailed[i][j] = str(self.map_detailed[i][j])

        print("Map Detailed: ")
        for row in self.map_detailed:

            print(row)
